<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{ccafs introduction}
%\VignetteEncoding{UTF-8}
-->

```{r echo=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.path = "img/"
)
```

ccafs introduction
==================

`ccafs` provides access to Climate Change, Agriculture, and Food Security (CCAFS)
General Circulation Models (GCM) data. Data is stored in Amazon S3, from
which we provide functions to fetch data.

Potential users are probably anyone from scientists asking questions about climate change, to scientists or companies projecting crop yields in the future.

## Install

Dev version

```{r eval=FALSE}
devtools::install_github("ropenscilabs/ccafs")
```

```{r}
library("ccafs")
```

```{r echo=FALSE}
cc_cache_delete_all()
```


## List keys

Keys are basically paths to files on Amazon S3's store of CCAFS files

```{r}
cc_list_keys()
```

Max keys

```{r}
cc_list_keys(max = 3)
```

Key prefix

```{r}
cc_list_keys(prefix = "ccafs/ccafs-climate/data/ipcc_5ar_ciat_downscaled/")
```

## Fetch some data

```{r}
key <- sub("\n|\\s+", "", paste0(
  "ccafs/ccafs-climate/data/ipcc_5ar_ciat_downscaled/rcp2_6/
  2030s/bcc_csm1_1_m/10min/",
  "bcc_csm1_1_m_rcp2_6_2030s_prec_10min_r1i1p1_no_tile_asc.zip"))
```

```{r}
(res <- cc_data_fetch(key = key))
```

### Caching

When requesting data, we first check if you already have that data cached.
You'll know when this happens as the request will finish much faster when
you have data cached already.

You can list cached files

```{r}
cc_cache_list()
```

See `?cc_cache` for all the cache management functions.

## Read data

After fetching data, you need to read the data into a `RasterLayer` or 
`RasterBrick` object

You can read a single file

```{r}
cc_data_read(res[1])
```

many files

```{r}
cc_data_read(res[1:2])
```

or all files

```{r}
cc_data_read(res)
```

## Visualize

```{r fig.width=10, fig.height=8}
library("raster")
plot(cc_data_read(res[1:6]))
```
